<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="704px" preserveAspectRatio="none" style="width:755px;height:704px;background:#F2EEE6;" version="1.1" viewBox="0 0 755 704" width="755px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="18" lengthAdjust="spacing" textLength="178" x="290.25" y="29.4023">Riiiverへログインする</text><rect fill="#FFFFFF" height="508.166" style="stroke:#222222;stroke-width:1.0;" width="10" x="477.5" y="180.3086"/><rect fill="#F3F0F0" height="420.5449" style="stroke:#000000;stroke-width:2.0;" width="739.5" x="9" y="259.9297"/><rect fill="#F3F0F0" height="61.9316" style="stroke:#000000;stroke-width:2.0;" width="298.5" x="440" y="551.9668"/><rect fill="#F3F0F0" height="59.5762" style="stroke:none;stroke-width:1.0;" width="739.5" x="9" y="620.8984"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="61" x2="61" y1="119.6875" y2="697.4746"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="136" x2="136" y1="119.6875" y2="697.4746"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="482" x2="482" y1="119.6875" y2="697.4746"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="589.5" x2="589.5" y1="119.6875" y2="697.4746"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="695.5" x2="695.5" y1="119.6875" y2="697.4746"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="14" lengthAdjust="spacing" textLength="31" x="43" y="116.7344">User</text><ellipse cx="61.5" cy="50.1992" fill="#EEEEEE" rx="8" ry="8" style="stroke:#000000;stroke-width:2.0;"/><path d="M61.5,58.1992 L61.5,85.1992 M48.5,66.1992 L74.5,66.1992 M61.5,85.1992 L48.5,100.1992 M61.5,85.1992 L74.5,100.1992 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><rect fill="#FFFFFF" height="34.0215" style="stroke:#111111;stroke-width:1.5;" width="87" x="93" y="84.666"/><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="73" x="100" y="108.1016">YourApp</text><rect fill="#FFFFFF" height="54.043" style="stroke:#111111;stroke-width:1.5;" width="65" x="450" y="64.6445"/><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="51" x="457" y="88.0801">Riiiver</text><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="33" x="466" y="108.1016">SDK</text><rect fill="#FFFFFF" height="54.043" style="stroke:#111111;stroke-width:1.5;" width="128" x="525.5" y="64.6445"/><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="45" x="567" y="88.0801">Safari</text><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="114" x="532.5" y="108.1016">(外部ブラウザ)</text><rect fill="#FFFFFF" height="54.043" style="stroke:#111111;stroke-width:1.5;" width="65" x="663.5" y="64.6445"/><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="51" x="670.5" y="88.0801">Riiiver</text><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="49" x="671.5" y="108.1016">Cloud</text><rect fill="#FFFFFF" height="508.166" style="stroke:#222222;stroke-width:1.0;" width="10" x="477.5" y="180.3086"/><polygon fill="#444444" points="124.5,146.998,134.5,150.998,124.5,154.998,128.5,150.998" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="61.5" x2="130.5" y1="150.998" y2="150.998"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="51" x="68.5" y="146.2559">App起動</text><polygon fill="#444444" points="465.5,176.3086,475.5,180.3086,465.5,184.3086,469.5,180.3086" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="136.5" x2="471.5" y1="180.3086" y2="180.3086"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="298" x="143.5" y="175.5664">ERAuth.getInstance().initialize(Context context)</text><polygon fill="#444444" points="465.5,216.2744,475.5,220.2744,465.5,224.2744,469.5,220.2744" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="136.5" x2="471.5" y1="220.2744" y2="220.2744"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="203" x="143.5" y="215.5322">ERAuth.getInstance().isLoggedIn</text><path d="M19,193.3086 L19,233.3086 L131,233.3086 L131,203.3086 L121,193.3086 L19,193.3086 " fill="#F9B5AD" style="stroke:#A80036;stroke-width:1.0;"/><path d="M121,193.3086 L121,203.3086 L131,203.3086 L121,193.3086 " fill="#F9B5AD" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="91" x="25" y="210.877">ログイン済みか</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="65" x="25" y="226.1875">確認する。</text><polygon fill="#444444" points="147.5,240.9297,137.5,244.9297,147.5,248.9297,143.5,244.9297" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="141.5" x2="476.5" y1="244.9297" y2="244.9297"/><path d="M9,259.9297 L71,259.9297 L71,266.9297 L61,276.9297 L9,276.9297 L9,259.9297 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="420.5449" style="stroke:#000000;stroke-width:2.0;" width="739.5" x="9" y="259.9297"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="24" y="273.498">alt</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="352" x="86" y="272.5645">[ERSDK: ERAuth.getInstance().isLoggedIn == false (未ログイン)]</text><polygon fill="#444444" points="465.5,340.4824,475.5,344.4824,465.5,348.4824,469.5,344.4824" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="136.5" x2="471.5" y1="344.4824" y2="344.4824"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="242" x="143.5" y="293.8086">ERAuth.sharedInstance.startWebLogin(</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="147" x="175.5" y="309.1191">List&lt;String&gt; deviceIds,</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="220" x="175.5" y="324.4297">IERAuthWebLoginCallback callback</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="4" x="143.5" y="339.7402">)</text><polygon fill="#444444" points="577.5,369.793,587.5,373.793,577.5,377.793,581.5,373.793" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="487.5" x2="583.5" y1="373.793" y2="373.793"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="78" x="494.5" y="369.0508">ログイン画面</text><polygon fill="#444444" points="577.5,399.1035,587.5,403.1035,577.5,407.1035,581.5,403.1035" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="61.5" x2="583.5" y1="403.1035" y2="403.1035"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="78" x="68.5" y="398.3613">ログイン操作</text><polygon fill="#444444" points="600.5,428.4141,590.5,432.4141,600.5,436.4141,596.5,432.4141" style="stroke:#444444;stroke-width:1.0;"/><polygon fill="#444444" points="684,428.4141,694,432.4141,684,436.4141,688,432.4141" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="594.5" x2="690" y1="432.4141" y2="432.4141"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="78" x="606.5" y="427.6719">認証プロセス</text><polygon fill="#444444" points="147.5,457.7246,137.5,461.7246,147.5,465.7246,143.5,461.7246" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="141.5" x2="588.5" y1="461.7246" y2="461.7246"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="154" x="153.5" y="456.9824">URLスキーマでアプリ起動</text><polygon fill="#444444" points="465.5,532.9668,475.5,536.9668,465.5,540.9668,469.5,536.9668" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="136.5" x2="471.5" y1="536.9668" y2="536.9668"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="317" x="143.5" y="486.293">ERAuth.sharedInstance.challengeAuthByWebLogin(</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="82" x="175.5" y="501.6035">Intent intent,</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="221" x="175.5" y="516.9141">IERAuthChallengeCallback callback</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="4" x="143.5" y="532.2246">)</text><path d="M19,487.0352 L19,527.0352 L131,527.0352 L131,497.0352 L121,487.0352 L19,487.0352 " fill="#F9B5AD" style="stroke:#A80036;stroke-width:1.0;"/><path d="M121,487.0352 L121,497.0352 L131,497.0352 L121,487.0352 " fill="#F9B5AD" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="91" x="25" y="504.6035">トークン保存を</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="52" x="25" y="519.9141">試みる。</text><path d="M440,551.9668 L502,551.9668 L502,558.9668 L492,568.9668 L440,568.9668 L440,551.9668 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.9316" style="stroke:#000000;stroke-width:2.0;" width="298.5" x="440" y="551.9668"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="455" y="565.5352">alt</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="122" x="517" y="564.6016">[callbackのonSuccess]</text><polygon fill="#444444" points="498.5,601.8984,488.5,605.8984,498.5,609.8984,494.5,605.8984" style="stroke:#444444;stroke-width:1.0;"/><polygon fill="#444444" points="684,601.8984,694,605.8984,684,609.8984,688,605.8984" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="492.5" x2="690" y1="605.8984" y2="605.8984"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="91" x="504.5" y="585.8457">ログイン完了。</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="117" x="504.5" y="601.1563">トークン保存成功。</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="9" x2="748.5" y1="621.8984" y2="621.8984"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="347" x="14" y="632.5332">[ERSDK: ERAuth.getInstance().isLoggedIn == true (ログイン済)]</text><polygon fill="#444444" points="498.5,668.4746,488.5,672.4746,498.5,676.4746,494.5,672.4746" style="stroke:#444444;stroke-width:1.0;"/><polygon fill="#444444" points="684,668.4746,694,672.4746,684,676.4746,688,672.4746" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="492.5" x2="690" y1="672.4746" y2="672.4746"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="91" x="504.5" y="652.4219">ログイン済み。</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="117" x="504.5" y="667.7324">トークン取得済み。</text><!--MD5=[38d563f94fc415eafd3a3578d4474d01]
@startuml
title Riiiverへログインする
hide footbox

skinparam DefaultFontName "Noto Sans JP, Helvetica, Arial, Liberation Sans"
skinparam BackgroundColor #F2EEE6
skinparam Shadowing false
skinparam NoteBackgroundColor #F9B5AD
skinparam NodeBorderColor #F26767

skinparam sequence {
ArrowColor #444444
ActorBorderColor Black
LifeLineBorderColor #222222
LifeLineBackgroundColor White
BoxBorderColor #FFFFFF
BoxBackgroundColor #F2fEf6
GroupBackgroundColor #FFFFFF
GroupBodyBackgroundColor #F3F0F0

ParticipantBorderColor #111111
ParticipantBackgroundColor White
ParticipantFontSize 17
ParticipantFontColor #111111
BoundaryBorderColor Gray
ActorBackgroundColor #eeeeee
ActorFontColor Black

}

actor User
participant YourApp as App
participant "Riiiver\nSDK" as ERSDK
participant "Safari\n(外部ブラウザ)" as Safari
participant "Riiiver\nCloud" as Riiiver

User -> App: App起動

App -> ERSDK: ERAuth.getInstance().initialize(Context context)
activate ERSDK

App -> ERSDK: ERAuth.getInstance().isLoggedIn
note left: ログイン済みか\n確認する。
ERSDK - -> App: 

alt ERSDK: ERAuth.getInstance().isLoggedIn == false (未ログイン)
    App -> ERSDK: ERAuth.sharedInstance.startWebLogin(\n\tList<String> deviceIds,\n\tIERAuthWebLoginCallback callback\n)
    ERSDK -> Safari: ログイン画面
    User -> Safari: ログイン操作
    Safari <-> Riiiver: 認証プロセス
    Safari -> App: URLスキーマでアプリ起動
    App -> ERSDK: ERAuth.sharedInstance.challengeAuthByWebLogin(\n\tIntent intent,\n\tIERAuthChallengeCallback callback\n)
    note left: トークン保存を\n試みる。
    alt callbackのonSuccess
        ERSDK <- - -> Riiiver: ログイン完了。\nトークン保存成功。 
    end
    
else ERSDK: ERAuth.getInstance().isLoggedIn == true (ログイン済)
    ERSDK <- - -> Riiiver: ログイン済み。\nトークン取得済み。
end





@enduml

PlantUML version 1.2021.2(Sun Mar 07 20:10:27 JST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: ja
Country: JP
--></g></svg>