<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="825px" preserveAspectRatio="none" style="width:770px;height:825px;background:#F2EEE6;" version="1.1" viewBox="0 0 770 825" width="770px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="18" lengthAdjust="spacing" textLength="178" x="297.5" y="29.4023">Riiiverへログインする</text><rect fill="#FFFFFF" height="29.3105" style="stroke:#222222;stroke-width:1.0;" width="10" x="482.5" y="180.3086"/><rect fill="#F3F0F0" height="511.7871" style="stroke:#000000;stroke-width:2.0;" width="754" x="9" y="289.2402"/><rect fill="#F3F0F0" height="168.4844" style="stroke:#000000;stroke-width:2.0;" width="734" x="19" y="565.9668"/><rect fill="#F3F0F0" height="61.9316" style="stroke:#000000;stroke-width:2.0;" width="298" x="445" y="665.5195"/><rect fill="#F3F0F0" height="59.5762" style="stroke:none;stroke-width:1.0;" width="754" x="9" y="741.4512"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="71" x2="71" y1="119.6875" y2="818.0273"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="146" x2="146" y1="119.6875" y2="818.0273"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="487" x2="487" y1="119.6875" y2="818.0273"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="594" x2="594" y1="119.6875" y2="818.0273"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="700" x2="700" y1="119.6875" y2="818.0273"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="14" lengthAdjust="spacing" textLength="31" x="53" y="116.7344">User</text><ellipse cx="71.5" cy="50.1992" fill="#EEEEEE" rx="8" ry="8" style="stroke:#000000;stroke-width:2.0;"/><path d="M71.5,58.1992 L71.5,85.1992 M58.5,66.1992 L84.5,66.1992 M71.5,85.1992 L58.5,100.1992 M71.5,85.1992 L84.5,100.1992 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><rect fill="#FFFFFF" height="34.0215" style="stroke:#111111;stroke-width:1.5;" width="87" x="103" y="84.666"/><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="73" x="110" y="108.1016">YourApp</text><rect fill="#FFFFFF" height="54.043" style="stroke:#111111;stroke-width:1.5;" width="65" x="455" y="64.6445"/><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="51" x="462" y="88.0801">Riiiver</text><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="33" x="471" y="108.1016">SDK</text><rect fill="#FFFFFF" height="54.043" style="stroke:#111111;stroke-width:1.5;" width="128" x="530" y="64.6445"/><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="45" x="571.5" y="88.0801">Safari</text><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="114" x="537" y="108.1016">(外部ブラウザ)</text><rect fill="#FFFFFF" height="54.043" style="stroke:#111111;stroke-width:1.5;" width="65" x="668" y="64.6445"/><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="51" x="675" y="88.0801">Riiiver</text><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="49" x="676" y="108.1016">Cloud</text><rect fill="#FFFFFF" height="29.3105" style="stroke:#222222;stroke-width:1.0;" width="10" x="482.5" y="180.3086"/><polygon fill="#444444" points="134.5,146.998,144.5,150.998,134.5,154.998,138.5,150.998" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="71.5" x2="140.5" y1="150.998" y2="150.998"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="51" x="78.5" y="146.2559">App起動</text><polygon fill="#444444" points="470.5,176.3086,480.5,180.3086,470.5,184.3086,474.5,180.3086" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="146.5" x2="476.5" y1="180.3086" y2="180.3086"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="147" x="153.5" y="175.5664">ERSDK.sharedInstance()</text><polygon fill="#444444" points="157.5,205.6191,147.5,209.6191,157.5,213.6191,153.5,209.6191" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="151.5" x2="486.5" y1="209.6191" y2="209.6191"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="23" x="163.5" y="204.877">sdk</text><polygon fill="#444444" points="475.5,245.585,485.5,249.585,475.5,253.585,479.5,249.585" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="146.5" x2="481.5" y1="249.585" y2="249.585"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="225" x="153.5" y="244.8428">ERAuth.sharedInstance.isLoggedIn()</text><path d="M29,222.6191 L29,262.6191 L141,262.6191 L141,232.6191 L131,222.6191 L29,222.6191 " fill="#F9B5AD" style="stroke:#A80036;stroke-width:1.0;"/><path d="M131,222.6191 L131,232.6191 L141,232.6191 L131,222.6191 " fill="#F9B5AD" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="91" x="35" y="240.1875">ログイン済みか</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="65" x="35" y="255.498">確認する。</text><polygon fill="#444444" points="157.5,270.2402,147.5,274.2402,157.5,278.2402,153.5,274.2402" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="151.5" x2="486.5" y1="274.2402" y2="274.2402"/><path d="M9,289.2402 L71,289.2402 L71,296.2402 L61,306.2402 L9,306.2402 L9,289.2402 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="511.7871" style="stroke:#000000;stroke-width:2.0;" width="754" x="9" y="289.2402"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="24" y="302.8086">alt</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="327" x="86" y="301.875">[ERAuth.sharedInstance.isLoggedIn() == false (未ログイン)]</text><polygon fill="#444444" points="475.5,369.793,485.5,373.793,475.5,377.793,479.5,373.793" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="146.5" x2="481.5" y1="373.793" y2="373.793"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="242" x="153.5" y="323.1191">ERAuth.sharedInstance.startWebLogin(</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="123" x="185.5" y="338.4297">deviceIds: deviceId,</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="150" x="185.5" y="353.7402">completion: completion</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="4" x="153.5" y="369.0508">)</text><polygon fill="#444444" points="582,399.1035,592,403.1035,582,407.1035,586,403.1035" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="487.5" x2="588" y1="403.1035" y2="403.1035"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="78" x="494.5" y="398.3613">ログイン画面</text><polygon fill="#444444" points="582,428.4141,592,432.4141,582,436.4141,586,432.4141" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="71.5" x2="588" y1="432.4141" y2="432.4141"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="78" x="78.5" y="427.6719">ログイン操作</text><polygon fill="#444444" points="605,457.7246,595,461.7246,605,465.7246,601,461.7246" style="stroke:#444444;stroke-width:1.0;"/><polygon fill="#444444" points="688.5,457.7246,698.5,461.7246,688.5,465.7246,692.5,461.7246" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="599" x2="694.5" y1="461.7246" y2="461.7246"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="78" x="611" y="456.9824">認証プロセス</text><polygon fill="#444444" points="157.5,487.0352,147.5,491.0352,157.5,495.0352,153.5,491.0352" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="151.5" x2="593" y1="491.0352" y2="491.0352"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="154" x="163.5" y="486.293">URLスキーマでアプリ起動</text><polygon fill="#444444" points="475.5,546.9668,485.5,550.9668,475.5,554.9668,479.5,550.9668" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="146.5" x2="481.5" y1="550.9668" y2="550.9668"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="193" x="153.5" y="515.6035">URLスキーマで渡されたデータを</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="116" x="153.5" y="530.9141">RiiiverSDKに渡す。</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="276" x="153.5" y="546.2246">ERAuth.sharedInstance.interceptApplication</text><path d="M19,565.9668 L81,565.9668 L81,572.9668 L71,582.9668 L19,582.9668 L19,565.9668 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="168.4844" style="stroke:#000000;stroke-width:2.0;" width="734" x="19" y="565.9668"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="34" y="579.5352">alt</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="317" x="96" y="578.6016">[ERAuth.sharedInstance.interceptApplicationの結果がtrue]</text><polygon fill="#444444" points="475.5,646.5195,485.5,650.5195,475.5,654.5195,479.5,650.5195" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="146.5" x2="481.5" y1="650.5195" y2="650.5195"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="317" x="153.5" y="599.8457">ERAuth.sharedInstance.challengeAuthByWebLogin(</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="121" x="185.5" y="615.1563">deviceIds: [String]?,</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="270" x="185.5" y="630.4668">completion:((Error?,ERAuthToken?)-&gt;Void)?</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="4" x="153.5" y="645.7773">)</text><path d="M29,600.5879 L29,640.5879 L141,640.5879 L141,610.5879 L131,600.5879 L29,600.5879 " fill="#F9B5AD" style="stroke:#A80036;stroke-width:1.0;"/><path d="M131,600.5879 L131,610.5879 L141,610.5879 L131,600.5879 " fill="#F9B5AD" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="91" x="35" y="618.1563">トークン保存を</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="52" x="35" y="633.4668">試みる。</text><path d="M445,665.5195 L507,665.5195 L507,672.5195 L497,682.5195 L445,682.5195 L445,665.5195 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.9316" style="stroke:#000000;stroke-width:2.0;" width="298" x="445" y="665.5195"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="460" y="679.0879">alt</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="192" x="522" y="678.1543">[completionハンドラーのErrorがnil]</text><polygon fill="#444444" points="498.5,715.4512,488.5,719.4512,498.5,723.4512,494.5,719.4512" style="stroke:#444444;stroke-width:1.0;"/><polygon fill="#444444" points="688.5,715.4512,698.5,719.4512,688.5,723.4512,692.5,719.4512" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="492.5" x2="694.5" y1="719.4512" y2="719.4512"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="91" x="504.5" y="699.3984">ログイン完了。</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="117" x="504.5" y="714.709">トークン保存成功。</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="9" x2="763" y1="742.4512" y2="742.4512"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="322" x="14" y="753.0859">[ERAuth.sharedInstance.isLoggedIn() == true (ログイン済)]</text><polygon fill="#444444" points="498.5,789.0273,488.5,793.0273,498.5,797.0273,494.5,793.0273" style="stroke:#444444;stroke-width:1.0;"/><polygon fill="#444444" points="688.5,789.0273,698.5,793.0273,688.5,797.0273,692.5,793.0273" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="492.5" x2="694.5" y1="793.0273" y2="793.0273"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="91" x="504.5" y="772.9746">ログイン済み。</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="117" x="504.5" y="788.2852">トークン取得済み。</text><!--MD5=[0d20ac2a4b4dfbb14164121a561756e1]
@startuml
title Riiiverへログインする
hide footbox

skinparam DefaultFontName "Noto Sans JP, Helvetica, Arial, Liberation Sans"
skinparam BackgroundColor #F2EEE6
skinparam Shadowing false
skinparam NoteBackgroundColor #F9B5AD
skinparam NodeBorderColor #F26767

skinparam sequence {
ArrowColor #444444
ActorBorderColor Black
LifeLineBorderColor #222222
LifeLineBackgroundColor White
BoxBorderColor #FFFFFF
BoxBackgroundColor #F2fEf6
GroupBackgroundColor #FFFFFF
GroupBodyBackgroundColor #F3F0F0

ParticipantBorderColor #111111
ParticipantBackgroundColor White
ParticipantFontSize 17
ParticipantFontColor #111111
BoundaryBorderColor Gray
ActorBackgroundColor #eeeeee
ActorFontColor Black

}

actor User
participant YourApp as App
participant "Riiiver\nSDK" as ERSDK
participant "Safari\n(外部ブラウザ)" as Safari
participant "Riiiver\nCloud" as Riiiver

User -> App: App起動

App -> ERSDK: ERSDK.sharedInstance()
activate ERSDK
App <- - ERSDK: sdk
deactivate ERSDK

App -> ERSDK: ERAuth.sharedInstance.isLoggedIn()
note left: ログイン済みか\n確認する。
ERSDK - -> App: 

alt ERAuth.sharedInstance.isLoggedIn() == false (未ログイン)
    App -> ERSDK: ERAuth.sharedInstance.startWebLogin(\n\tdeviceIds: deviceId,\n\tcompletion: completion\n)
    ERSDK -> Safari: ログイン画面
    User -> Safari: ログイン操作
    Safari <-> Riiiver: 認証プロセス
    Safari -> App: URLスキーマでアプリ起動
    App -> ERSDK: URLスキーマで渡されたデータを\nRiiiverSDKに渡す。\nERAuth.sharedInstance.interceptApplication
    alt ERAuth.sharedInstance.interceptApplicationの結果がtrue
        App -> ERSDK: ERAuth.sharedInstance.challengeAuthByWebLogin(\n\tdeviceIds: [String]?, \n\tcompletion:((Error?,ERAuthToken?)->Void)?\n)
        note left: トークン保存を\n試みる。
        alt completionハンドラーのErrorがnil
            ERSDK <- - -> Riiiver: ログイン完了。\nトークン保存成功。 
        end
    end
    
else ERAuth.sharedInstance.isLoggedIn() == true (ログイン済)
    ERSDK <- - -> Riiiver: ログイン済み。\nトークン取得済み。
end





@enduml

PlantUML version 1.2021.2(Sun Mar 07 20:10:27 JST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: ja
Country: JP
--></g></svg>