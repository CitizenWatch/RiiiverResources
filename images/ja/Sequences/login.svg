<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="766px" preserveAspectRatio="none" style="width:770px;height:766px;background:#F2EEE6;" version="1.1" viewBox="0 0 770 766" width="770px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="18" lengthAdjust="spacing" textLength="178" x="297.5" y="29.4023">Riiiverへログインする</text><rect fill="#F3F0F0" height="511.7871" style="stroke:#000000;stroke-width:2.0;" width="754" x="9" y="230.6191"/><rect fill="#F3F0F0" height="168.4844" style="stroke:#000000;stroke-width:2.0;" width="734" x="19" y="507.3457"/><rect fill="#F3F0F0" height="61.9316" style="stroke:#000000;stroke-width:2.0;" width="298" x="445" y="606.8984"/><rect fill="#F3F0F0" height="59.5762" style="stroke:none;stroke-width:1.0;" width="754" x="9" y="682.8301"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="71" x2="71" y1="119.6875" y2="759.4063"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="146" x2="146" y1="119.6875" y2="759.4063"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="487" x2="487" y1="119.6875" y2="759.4063"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="594" x2="594" y1="119.6875" y2="759.4063"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="700" x2="700" y1="119.6875" y2="759.4063"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="14" lengthAdjust="spacing" textLength="31" x="53" y="116.7344">User</text><ellipse cx="71.5" cy="50.1992" fill="#EEEEEE" rx="8" ry="8" style="stroke:#000000;stroke-width:2.0;"/><path d="M71.5,58.1992 L71.5,85.1992 M58.5,66.1992 L84.5,66.1992 M71.5,85.1992 L58.5,100.1992 M71.5,85.1992 L84.5,100.1992 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><rect fill="#FFFFFF" height="34.0215" style="stroke:#111111;stroke-width:1.5;" width="87" x="103" y="84.666"/><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="73" x="110" y="108.1016">YourApp</text><rect fill="#FFFFFF" height="54.043" style="stroke:#111111;stroke-width:1.5;" width="65" x="455" y="64.6445"/><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="51" x="462" y="88.0801">Riiiver</text><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="33" x="471" y="108.1016">SDK</text><rect fill="#FFFFFF" height="54.043" style="stroke:#111111;stroke-width:1.5;" width="128" x="530" y="64.6445"/><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="45" x="571.5" y="88.0801">Safari</text><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="114" x="537" y="108.1016">(外部ブラウザ)</text><rect fill="#FFFFFF" height="54.043" style="stroke:#111111;stroke-width:1.5;" width="65" x="668" y="64.6445"/><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="51" x="675" y="88.0801">Riiiver</text><text fill="#111111" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="17" lengthAdjust="spacing" textLength="49" x="676" y="108.1016">Cloud</text><polygon fill="#444444" points="134.5,146.998,144.5,150.998,134.5,154.998,138.5,150.998" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="71.5" x2="140.5" y1="150.998" y2="150.998"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="51" x="78.5" y="146.2559">App起動</text><polygon fill="#444444" points="475.5,186.9639,485.5,190.9639,475.5,194.9639,479.5,190.9639" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="146.5" x2="481.5" y1="190.9639" y2="190.9639"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="225" x="153.5" y="186.2217">ERAuth.sharedInstance.isLoggedIn()</text><path d="M29,163.998 L29,203.998 L141,203.998 L141,173.998 L131,163.998 L29,163.998 " fill="#F9B5AD" style="stroke:#A80036;stroke-width:1.0;"/><path d="M131,163.998 L131,173.998 L141,173.998 L131,163.998 " fill="#F9B5AD" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="91" x="35" y="181.5664">ログイン済みか</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="65" x="35" y="196.877">確認する。</text><polygon fill="#444444" points="157.5,211.6191,147.5,215.6191,157.5,219.6191,153.5,215.6191" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="151.5" x2="486.5" y1="215.6191" y2="215.6191"/><path d="M9,230.6191 L71,230.6191 L71,237.6191 L61,247.6191 L9,247.6191 L9,230.6191 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="511.7871" style="stroke:#000000;stroke-width:2.0;" width="754" x="9" y="230.6191"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="24" y="244.1875">alt</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="327" x="86" y="243.2539">[ERAuth.sharedInstance.isLoggedIn() == false (未ログイン)]</text><polygon fill="#444444" points="475.5,311.1719,485.5,315.1719,475.5,319.1719,479.5,315.1719" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="146.5" x2="481.5" y1="315.1719" y2="315.1719"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="242" x="153.5" y="264.498">ERAuth.sharedInstance.startWebLogin(</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="123" x="185.5" y="279.8086">deviceIds: deviceId,</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="150" x="185.5" y="295.1191">completion: completion</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="4" x="153.5" y="310.4297">)</text><polygon fill="#444444" points="582,340.4824,592,344.4824,582,348.4824,586,344.4824" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="487.5" x2="588" y1="344.4824" y2="344.4824"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="78" x="494.5" y="339.7402">ログイン画面</text><polygon fill="#444444" points="582,369.793,592,373.793,582,377.793,586,373.793" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="71.5" x2="588" y1="373.793" y2="373.793"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="78" x="78.5" y="369.0508">ログイン操作</text><polygon fill="#444444" points="605,399.1035,595,403.1035,605,407.1035,601,403.1035" style="stroke:#444444;stroke-width:1.0;"/><polygon fill="#444444" points="688.5,399.1035,698.5,403.1035,688.5,407.1035,692.5,403.1035" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="599" x2="694.5" y1="403.1035" y2="403.1035"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="78" x="611" y="398.3613">認証プロセス</text><polygon fill="#444444" points="157.5,428.4141,147.5,432.4141,157.5,436.4141,153.5,432.4141" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="151.5" x2="593" y1="432.4141" y2="432.4141"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="154" x="163.5" y="427.6719">URLスキーマでアプリ起動</text><polygon fill="#444444" points="475.5,488.3457,485.5,492.3457,475.5,496.3457,479.5,492.3457" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="146.5" x2="481.5" y1="492.3457" y2="492.3457"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="193" x="153.5" y="456.9824">URLスキーマで渡されたデータを</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="116" x="153.5" y="472.293">RiiiverSDKに渡す。</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="276" x="153.5" y="487.6035">ERAuth.sharedInstance.interceptApplication</text><path d="M19,507.3457 L81,507.3457 L81,514.3457 L71,524.3457 L19,524.3457 L19,507.3457 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="168.4844" style="stroke:#000000;stroke-width:2.0;" width="734" x="19" y="507.3457"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="34" y="520.9141">alt</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="317" x="96" y="519.9805">[ERAuth.sharedInstance.interceptApplicationの結果がtrue]</text><polygon fill="#444444" points="475.5,587.8984,485.5,591.8984,475.5,595.8984,479.5,591.8984" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;" x1="146.5" x2="481.5" y1="591.8984" y2="591.8984"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="317" x="153.5" y="541.2246">ERAuth.sharedInstance.challengeAuthByWebLogin(</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="121" x="185.5" y="556.5352">deviceIds: [String]?,</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="270" x="185.5" y="571.8457">completion:((Error?,ERAuthToken?)-&gt;Void)?</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="4" x="153.5" y="587.1563">)</text><path d="M29,541.9668 L29,581.9668 L141,581.9668 L141,551.9668 L131,541.9668 L29,541.9668 " fill="#F9B5AD" style="stroke:#A80036;stroke-width:1.0;"/><path d="M131,541.9668 L131,551.9668 L141,551.9668 L131,541.9668 " fill="#F9B5AD" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="91" x="35" y="559.5352">トークン保存を</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="52" x="35" y="574.8457">試みる。</text><path d="M445,606.8984 L507,606.8984 L507,613.8984 L497,623.8984 L445,623.8984 L445,606.8984 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.9316" style="stroke:#000000;stroke-width:2.0;" width="298" x="445" y="606.8984"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="460" y="620.4668">alt</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="192" x="522" y="619.5332">[completionハンドラーのErrorがnil]</text><polygon fill="#444444" points="498.5,656.8301,488.5,660.8301,498.5,664.8301,494.5,660.8301" style="stroke:#444444;stroke-width:1.0;"/><polygon fill="#444444" points="688.5,656.8301,698.5,660.8301,688.5,664.8301,692.5,660.8301" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="492.5" x2="694.5" y1="660.8301" y2="660.8301"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="91" x="504.5" y="640.7773">ログイン完了。</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="117" x="504.5" y="656.0879">トークン保存成功。</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="9" x2="763" y1="683.8301" y2="683.8301"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="322" x="14" y="694.4648">[ERAuth.sharedInstance.isLoggedIn() == true (ログイン済)]</text><polygon fill="#444444" points="498.5,730.4063,488.5,734.4063,498.5,738.4063,494.5,734.4063" style="stroke:#444444;stroke-width:1.0;"/><polygon fill="#444444" points="688.5,730.4063,698.5,734.4063,688.5,738.4063,692.5,734.4063" style="stroke:#444444;stroke-width:1.0;"/><line style="stroke:#444444;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="492.5" x2="694.5" y1="734.4063" y2="734.4063"/><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="91" x="504.5" y="714.3535">ログイン済み。</text><text fill="#000000" font-family="Noto Sans JP, Helvetica, Arial, Liberation Sans" font-size="13" lengthAdjust="spacing" textLength="117" x="504.5" y="729.6641">トークン取得済み。</text><!--MD5=[9695aaef62affdea4c42783bcc9b2e81]
@startuml
title Riiiverへログインする
hide footbox

skinparam DefaultFontName "Noto Sans JP, Helvetica, Arial, Liberation Sans"
skinparam BackgroundColor #F2EEE6
skinparam Shadowing false
skinparam NoteBackgroundColor #F9B5AD
skinparam NodeBorderColor #F26767

skinparam sequence {
ArrowColor #444444
ActorBorderColor Black
LifeLineBorderColor #222222
LifeLineBackgroundColor White
BoxBorderColor #FFFFFF
BoxBackgroundColor #F2fEf6
GroupBackgroundColor #FFFFFF
GroupBodyBackgroundColor #F3F0F0

ParticipantBorderColor #111111
ParticipantBackgroundColor White
ParticipantFontSize 17
ParticipantFontColor #111111
BoundaryBorderColor Gray
ActorBackgroundColor #eeeeee
ActorFontColor Black

}

actor User
participant YourApp as App
participant "Riiiver\nSDK" as ERSDK
participant "Safari\n(外部ブラウザ)" as Safari
participant "Riiiver\nCloud" as Riiiver

User -> App: App起動

App -> ERSDK: ERAuth.sharedInstance.isLoggedIn()
note left: ログイン済みか\n確認する。
ERSDK - -> App: 

alt ERAuth.sharedInstance.isLoggedIn() == false (未ログイン)
    App -> ERSDK: ERAuth.sharedInstance.startWebLogin(\n\tdeviceIds: deviceId,\n\tcompletion: completion\n)
    ERSDK -> Safari: ログイン画面
    User -> Safari: ログイン操作
    Safari <-> Riiiver: 認証プロセス
    Safari -> App: URLスキーマでアプリ起動
    App -> ERSDK: URLスキーマで渡されたデータを\nRiiiverSDKに渡す。\nERAuth.sharedInstance.interceptApplication
    alt ERAuth.sharedInstance.interceptApplicationの結果がtrue
        App -> ERSDK: ERAuth.sharedInstance.challengeAuthByWebLogin(\n\tdeviceIds: [String]?, \n\tcompletion:((Error?,ERAuthToken?)->Void)?\n)
        note left: トークン保存を\n試みる。
        alt completionハンドラーのErrorがnil
            ERSDK <- - -> Riiiver: ログイン完了。\nトークン保存成功。 
        end
    end
    
else ERAuth.sharedInstance.isLoggedIn() == true (ログイン済)
    ERSDK <- - -> Riiiver: ログイン済み。\nトークン取得済み。
end





@enduml

PlantUML version 1.2021.2(Sun Mar 07 20:10:27 JST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: ja
Country: JP
--></g></svg>